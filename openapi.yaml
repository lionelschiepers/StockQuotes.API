openapi: 3.0.3
info:
  title: Stock Quotes API
  description: |
    API for retrieving stock market data including real-time quotes and historical price data.

    ## Rate Limiting
    All endpoints are rate-limited to 20 requests per minute per IP address.

    ## Caching
    Historical data is cached for 1 hour. Responses include `X-Cache` header indicating cache status.

    ## ETags
    Historical endpoint supports HTTP conditional requests via ETags. Include `If-None-Match` header 
    with the ETag value to receive 304 Not Modified when data hasn't changed.
  version: 1.0.0
  contact:
    name: Stock Quotes API Support

servers:
  - url: http://localhost:7071/api
    description: Local development server
  - url: https://your-production-url/api
    description: Production server

paths:
  /yahoo-finance-historical:
    get:
      summary: Get historical stock data
      description: |
        Retrieve historical price data for a specific stock ticker.

        ### Date Range Limits by Interval
        - **Intraday** (1m, 2m, 5m, 15m, 30m, 60m, 90m, 1h): Maximum 7 days
        - **Daily** (1d): Maximum 5 years
        - **Weekly** (1w, 1wk): Maximum 20 years
        - **Monthly** (1mo, 3mo): Maximum 50 years
      operationId: getHistoricalData
      tags:
        - Historical Data
      parameters:
        - name: ticker
          in: query
          required: true
          schema:
            type: string
          example: AAPL
          description: Stock ticker symbol (e.g., AAPL, MSFT, GOOGL)
        - name: from
          in: query
          required: true
          schema:
            type: string
            format: date
          example: '2024-01-01'
          description: Start date in yyyy-MM-dd format
        - name: to
          in: query
          required: true
          schema:
            type: string
            format: date
          example: '2024-12-31'
          description: End date in yyyy-MM-dd format
        - name: interval
          in: query
          required: false
          schema:
            type: string
            enum:
              - 1m
              - 2m
              - 5m
              - 15m
              - 30m
              - 60m
              - 90m
              - 1h
              - 1d
              - 1w
              - 1wk
              - 1mo
              - 3mo
            default: 1d
          example: 1d
          description: |
            Data interval. Note: Intraday intervals (less than 1 day) limited to 7 days of data.
            - `1m`, `2m`, `5m`, `15m`, `30m`, `60m`, `90m`, `1h` - Intraday (max 7 days)
            - `1d` - Daily (max 5 years)
            - `1w`, `1wk` - Weekly (max 20 years)
            - `1mo`, `3mo` - Monthly (max 50 years)
        - name: fields
          in: query
          required: false
          schema:
            type: string
          example: close,volume
          description: |
            Comma or pipe-separated list of fields to include in response.
            Available fields: date, open, high, low, close, volume
      responses:
        '200':
          description: Historical data retrieved successfully
          headers:
            X-RateLimit-Limit:
              schema:
                type: integer
              description: Maximum number of requests allowed per minute
            X-RateLimit-Remaining:
              schema:
                type: integer
              description: Number of requests remaining in current window
            X-RateLimit-Reset:
              schema:
                type: string
                format: date-time
              description: Time when rate limit window resets
            X-Cache:
              schema:
                type: string
                enum: [HIT, MISS]
              description: Indicates if response was served from cache
            ETag:
              schema:
                type: string
              description: Entity tag for conditional requests
            Cache-Control:
              schema:
                type: string
              description: Cache directives (max-age=3600)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HistoricalResponse'
              example:
                meta:
                  currency: USD
                  symbol: AAPL
                  exchangeName: NMS
                  instrumentType: EQUITY
                  firstTradeDate: 345479400
                  regularMarketTime: 1704067200
                  gmtoffset: -18000
                  timezone: EST
                  exchangeTimezoneName: America/New_York
                  regularMarketPrice: 192.53
                  chartPreviousClose: 192.32
                  previousClose: 192.32
                  scale: 3
                  priceHint: 2
                  currentTradingPeriod:
                    pre:
                      timezone: EST
                      start: 1704099600
                      end: 1704119400
                      gmtoffset: -18000
                    regular:
                      timezone: EST
                      start: 1704119400
                      end: 1704142800
                      gmtoffset: -18000
                    post:
                      timezone: EST
                      start: 1704142800
                      end: 1704157200
                      gmtoffset: -18000
                  tradingPeriods:
                    - - timezone: EST
                        start: 1704119400
                        end: 1704142800
                        gmtoffset: -18000
                  dataGranularity: 1d
                  range: 1y
                  validRanges:
                    - 1d
                    - 5d
                    - 1mo
                    - 3mo
                    - 6mo
                    - 1y
                    - 2y
                    - 5y
                    - 10y
                    - ytd
                    - max
                quotes:
                  - date: '2024-01-02T00:00:00.000Z'
                    open: 187.15
                    high: 188.44
                    low: 186.79
                    close: 188.32
                    volume: 52696900
                  - date: '2024-01-03T00:00:00.000Z'
                    open: 187.55
                    high: 188.18
                    low: 185.85
                    close: 186.52
                    volume: 53103300
        '304':
          description: Not Modified - Data hasn't changed since last request
          headers:
            ETag:
              schema:
                type: string
              description: Entity tag that matched the If-None-Match header
            X-RateLimit-Limit:
              schema:
                type: integer
              description: Maximum number of requests allowed per minute
            X-RateLimit-Remaining:
              schema:
                type: integer
              description: Number of requests remaining in current window
            X-RateLimit-Reset:
              schema:
                type: string
                format: date-time
              description: Time when rate limit window resets
        '400':
          description: Bad Request - Invalid parameters
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                missingTicker:
                  summary: Missing required parameter
                  value:
                    error: 'Missing required parameter: ticker'
                invalidDateFormat:
                  summary: Invalid date format
                  value:
                    error: 'From date must be in yyyy-MM-dd format'
                invalidInterval:
                  summary: Invalid interval
                  value:
                    error: 'Interval must be one of: 1m, 2m, 5m, 15m, 30m, 60m, 90m, 1h, 1d, 1w, 1wk, 1mo, 3mo'
                dateRangeExceeded:
                  summary: Date range exceeded
                  value:
                    error: 'Date range exceeds maximum of 7 days for intraday interval "1m"'
        '429':
          description: Too Many Requests - Rate limit exceeded
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                error: 'Too many requests'
                message: 'Rate limit exceeded. Please try again later.'
                retryAfter: 30
          headers:
            Retry-After:
              schema:
                type: integer
              description: Seconds until rate limit resets
            X-RateLimit-Limit:
              schema:
                type: integer
              description: Maximum number of requests allowed per minute
            X-RateLimit-Remaining:
              schema:
                type: integer
              description: Number of requests remaining (0 when limited)
            X-RateLimit-Reset:
              schema:
                type: string
                format: date-time
              description: Time when rate limit window resets
        '500':
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                error: 'Internal server error'
                message: 'An unexpected error occurred'
        '502':
          description: Bad Gateway - External API error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                error: 'External API error'
                message: 'Service unavailable'
                status: 503

  /yahoo-finance-quotes:
    get:
      summary: Get stock quotes
      description: |
        Retrieve real-time stock quotes for one or more ticker symbols.
        Supports multiple symbols in a single request.
      operationId: getQuotes
      tags:
        - Quotes
      parameters:
        - name: symbols
          in: query
          required: true
          schema:
            type: string
          example: AAPL,MSFT,GOOGL
          description: |
            Comma or pipe-separated list of stock ticker symbols.
            Maximum 50 symbols per request.
        - name: fields
          in: query
          required: true
          schema:
            type: string
          example: regularMarketPrice,regularMarketChange,regularMarketChangePercent
          description: |
            Comma or pipe-separated list of fields to retrieve.
            Maximum 20 fields per request.
            Common fields include:
            - regularMarketPrice
            - regularMarketChange
            - regularMarketChangePercent
            - regularMarketVolume
            - marketCap
            - trailingPE
            - dividendYield
      responses:
        '200':
          description: Quotes retrieved successfully
          headers:
            X-RateLimit-Limit:
              schema:
                type: integer
              description: Maximum number of requests allowed per minute
            X-RateLimit-Remaining:
              schema:
                type: integer
              description: Number of requests remaining in current window
            X-RateLimit-Reset:
              schema:
                type: string
                format: date-time
              description: Time when rate limit window resets
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/QuoteResponse'
              example:
                - symbol: AAPL
                  regularMarketPrice: 192.53
                  regularMarketChange: 1.21
                  regularMarketChangePercent: 0.63
                  regularMarketVolume: 52696900
                  marketCap: 2950000000000
                  trailingPE: 29.8
        '400':
          description: Bad Request - Invalid parameters
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '429':
          description: Too Many Requests - Rate limit exceeded
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal Server Error

components:
  schemas:
    HistoricalResponse:
      type: object
      properties:
        meta:
          type: object
          description: Metadata about the chart data
          properties:
            currency:
              type: string
              example: USD
            symbol:
              type: string
              example: AAPL
            exchangeName:
              type: string
              example: NMS
            instrumentType:
              type: string
              example: EQUITY
            firstTradeDate:
              type: integer
              description: Unix timestamp of first trade date
            regularMarketTime:
              type: integer
              description: Unix timestamp of regular market time
            gmtoffset:
              type: integer
              description: GMT offset in seconds
            timezone:
              type: string
              example: EST
            exchangeTimezoneName:
              type: string
              example: America/New_York
            regularMarketPrice:
              type: number
              example: 192.53
            chartPreviousClose:
              type: number
              example: 192.32
            previousClose:
              type: number
              example: 192.32
            scale:
              type: integer
            priceHint:
              type: integer
            currentTradingPeriod:
              type: object
              properties:
                pre:
                  $ref: '#/components/schemas/TradingPeriod'
                regular:
                  $ref: '#/components/schemas/TradingPeriod'
                post:
                  $ref: '#/components/schemas/TradingPeriod'
            tradingPeriods:
              type: array
              items:
                type: array
                items:
                  $ref: '#/components/schemas/TradingPeriod'
            dataGranularity:
              type: string
              example: 1d
            range:
              type: string
              example: 1y
            validRanges:
              type: array
              items:
                type: string
        quotes:
          type: array
          description: Array of historical price data points
          items:
            $ref: '#/components/schemas/HistoricalQuote'

    HistoricalQuote:
      type: object
      description: Individual price data point
      properties:
        date:
          type: string
          format: date-time
          description: Date/time of the price point
        open:
          type: number
          description: Opening price
        high:
          type: number
          description: Highest price
        low:
          type: number
          description: Lowest price
        close:
          type: number
          description: Closing price
        volume:
          type: integer
          description: Trading volume
      required:
        - date

    TradingPeriod:
      type: object
      properties:
        timezone:
          type: string
          example: EST
        start:
          type: integer
          description: Unix timestamp
        end:
          type: integer
          description: Unix timestamp
        gmtoffset:
          type: integer

    QuoteResponse:
      type: object
      description: Stock quote data
      properties:
        symbol:
          type: string
          example: AAPL
        regularMarketPrice:
          type: number
          description: Current market price
        regularMarketChange:
          type: number
          description: Price change
        regularMarketChangePercent:
          type: number
          description: Price change percentage
        regularMarketVolume:
          type: integer
          description: Trading volume
        marketCap:
          type: integer
          description: Market capitalization
        trailingPE:
          type: number
          description: Price-to-earnings ratio
        dividendYield:
          type: number
          description: Dividend yield

    ErrorResponse:
      type: object
      properties:
        error:
          type: string
          description: Error type/code
        message:
          type: string
          description: Human-readable error message
        status:
          type: integer
          description: HTTP status code (when applicable)
        retryAfter:
          type: integer
          description: Seconds to wait before retry (rate limit errors only)
      required:
        - error

  parameters:
    TickerParam:
      name: ticker
      in: query
      required: true
      schema:
        type: string
      description: Stock ticker symbol

  headers:
    RateLimitHeaders:
      X-RateLimit-Limit:
        schema:
          type: integer
        description: Maximum requests per minute
      X-RateLimit-Remaining:
        schema:
          type: integer
        description: Remaining requests in current window
      X-RateLimit-Reset:
        schema:
          type: string
          format: date-time
        description: Rate limit reset time

tags:
  - name: Historical Data
    description: Retrieve historical stock price data
  - name: Quotes
    description: Retrieve real-time stock quotes
